<!DOCTYPE html>
<html>
<head>
	<script src = "vector.js"></script>
	<script src = "2.js"></script>
</head>
<body>


<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 -10 100 110" xml:space="preserve">
<style type="text/css">
	.st0{fill:#EAB52F;}
	.st1{fill:#D8A003;}
	.st2{fill:#F9D069;}
	.st3{fill:#7C7C93;}
	.anchor-rel{
		fill: green;
	}
	.anchor-abs{
		fill: red;
	}
</style>

<g>
	<g>
		<polygon class="st0" points="24.38,50.62 33.02,54.94 33.95,98.05 25.26,93.21 		"/>
		<path class="st1" d="M75.62,37.82c0,0-22.22,14.99-42.61,17.12l-8.64-4.32c0,0,7.8-9.35,41.18-17.35L75.62,37.82z"/>
		<path class="st2" d="M75.62,81.27V37.82c-0.07-0.14-19.4,13.54-42.61,17.12l0.94,43.11C33.95,98.05,57.65,94.1,75.62,81.27z"/>
	</g>
	<path id="lock" class="st3" d="M39.720,48.780C39.720,48.780,39.030,51.150,35.180,51.150S30.540,49.670,31.130,48.780C31.130,48.780,32.070,36.790,32.070,30.170c0.0000-12.050,9.1800-27.410,22.320-28.190c10.860-0.64000,14.660,10.570,14.660,16.930s0.0000,18.710,0.0000,18.710s-0.89000,2.1700-3.9000,2.0200c-3.0100-0.15000-4.9400-1.5300-4.4400-2.5200c0.49000-0.99000,0.39000-13.230,0.39000-18.120s-3.0600-11.800-9.5300-7.9000s-10.660,10.610-11.210,19.800z"></path>
</g>
<script>
	class Dots extends SvgPlus{
		constructor(path){
			super('g');
			this.path = path;

		}
		draw(){
			this.innerHTML = '';
			let major = null;
			if (this.path instanceof SVGPathElement){

				this.path.d.forEach((link, i) => {
					if (i == 3) major = link;

					let anchor = this.createChild('ellipse');
					anchor.props = {
						cx: link.absolute.x,
						cy: link.absolute.y,
						rx: '1',
						ry: '1',
						class: link.isAbsolute() ? 'anchor-abs' : 'anchor-rel'
					}

					anchor.onclick = () => {
						console.log(`abs: ${link.absolute}, rel: ${link.relative}`);
						console.log(`abs: ${link.last.absolute}, rel: ${link.last.relative}`);
						link.toggleAbsolute();
						this.draw();
					}
				})
				major.add(new Vector(0, -10))
				this.path.d._update();
			}
		}
	}

	class LockBar extends SvgPath{
		build(){
			this.lockStart = this.d.start.next.next.next;
			this.yval = 0;
			this.defaultSpeed = 0.3;
			this.open = true;
		}

		set open(val){
			if (val){
				this.openLock();
				this._open = true;
			}else{
				this.closeLock();
				this._open = false;
			}
		}
		get open(){
			return this._open
		}

		onclick(){
			this.open = !this.open
		}


		async openLock(){
			this.speed = this.defaultSpeed;
			return new Promise((resolve, reject) => {
				let next = () => {
					this.lockStart.add(new Vector(0, -this.speed));
					this.yval += this.speed;
					this.d._update();
					if (this.yval < 10){
						window.requestAnimationFrame(next)
					}else{
						resolve(true)
					}
				}
				window.requestAnimationFrame(next)
			})
		}

		async closeLock(){
			this.speed = this.defaultSpeed;
			return new Promise((resolve, reject) => {
				let next = () => {
					this.speed += 0.05;
					this.lockStart.add(new Vector(0, this.speed));
					this.yval += -this.speed;
					this.d._update();
					if (this.yval > 0){
						window.requestAnimationFrame(next)
					}else{
						resolve(true)
					}
				}
				window.requestAnimationFrame(next)
			})
		}
	}

	let svg = new SvgPlus('Layer_1')
	let path = new LockBar('lock');
	// let dots= new Dots(path);
	// svg.appendChild(dots);
	// dots.draw();
	// path.makeAbsolute()
</script>
</body>

</svg>


</html>
